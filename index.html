<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafetería "El Grano de Oro" - Tarjeta de Lealtad</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
    <header>
        <h1>Cafetería "El Grano de Oro"</h1>
        <div class="user-info">
            <p>Bienvenido, <span id="user-name">Invitado</span></p>
            <button id="auth-btn">Iniciar Sesión</button>
        </div>
    </header>

    <main>
        <section id="loyalty-card" class="hidden">
            <h2>Tu Tarjeta de Lealtad</h2>
            <div id="stamps-display">
                </div>
            <p id="message">¡Bienvenido! Acumula sellos por cada café.</p>
            <div class="confetti-container" id="confetti-container"></div>
            <div id="qr-section">
                <h3>Escanea este código para acumular sellos:</h3>
                <canvas id="qrcode-canvas"></canvas>
                <p id="qr-instruction">Muestra este código al barista para registrar tu compra.</p>
            </div>
        </section>

        <section id="history-section" class="hidden">
            <h3>Tu Historial de Sellos</h3>
            <ul id="stamps-history-list">
                </ul>
        </section>

        <section id="admin-section" class="hidden">
            <h2>Panel de Administración</h2>

            <div class="admin-input-group">
                <input type="text" id="client-uid-input" placeholder="Email o UID del Cliente">
                <button id="search-client-btn">Buscar Cliente</button>
                <button id="scan-qr-btn">Escanear QR</button>
            </div>

            <div id="admin-client-info">
                <p><strong>Cliente Cargado:</strong> <span id="loaded-client-name">No hay cliente cargado.</span></p>
                <p><strong>Email/UID:</strong> <span id="loaded-client-uid">N/A</span></p>
                <p><strong>Sellos Actuales:</strong> <span id="admin-current-stamps">N/A</span></p>
            </div>

            <div class="admin-actions">
                <button id="add-stamp-btn">Añadir Sello</button>
                <button id="remove-stamp-btn">Quitar Sello</button>
                <button id="redeem-coffee-btn">Canjear Café Gratis</button>
                <button id="reset-stamps-btn">Reiniciar Tarjeta</button>
            </div>
            <p id="admin-message"></p>
        </section>

        <section id="admin-dashboard" class="hidden">
            <h3>Resumen del Programa de Lealtad</h3>
            <div class="dashboard-stats">
                <div class="stat-box">
                    <h4>Total Clientes</h4>
                    <p id="total-customers-stat">...</p>
                </div>
                <div class="stat-box">
                    <h4>Cafés Gratis Pendientes</h4>
                    <p id="pending-rewards-stat">...</p>
                </div>
                <div class="stat-box">
                    <h4>Promedio de Sellos</h4>
                    <p id="average-stamps-stat">...</p>
                </div>
            </div>
        </section>

        <section id="report-section" class="hidden">
            <h3>Reportes y Analíticas Básicas</h3>
            <div class="report-controls">
                <label for="report-period-select">Ver datos de los últimos:</label>
                <select id="report-period-select">
                    <option value="7">7 días</option>
                    <option value="30">30 días</option>
                    <option value="90">90 días</option>
                    <option value="365">1 año</option>
                    <option value="all">Todo el tiempo</option>
                </select>
                <button id="generate-report-btn">Generar Reporte</button>
            </div>
            <div id="report-results">
                <h4>Reporte de los últimos <span id="report-period-display">7 días</span>:</h4>
                <p>Sellos Añadidos: <strong id="stamps-added-stat">0</strong></p>
                <p>Cafés Gratuitos Canjeados: <strong id="rewards-redeemed-stat">0</strong></p>
                <p>Tarjetas Reiniciadas: <strong id="cards-reset-stat">0</strong></p>
                <p>Sellos Quitados: <strong id="stamps-removed-stat">0</strong></p>
                </div>
        </section>
    </main>

    <div id="qr-scanner-overlay" class="hidden">
        <div id="qr-scanner-container">
            <div id="reader"></div> <button id="close-scanner-btn">X</button>
        </div>
        <p id="scanner-message">Escaneando...</p>
    </div>

    <script src="script.js"></script>
</body>
</html>
